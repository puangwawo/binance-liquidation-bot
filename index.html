
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XRP Signals ‚Äî OBI ‚Ä¢ VWAP ‚Ä¢ Volume ‚Ä¢ Sweep ‚Ä¢ Funding/OI</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,#0ea5e9 0%,#6366f1 100%);min-height:100vh;color:#0f172a}
    .container{max-width:1300px;margin:0 auto;padding:18px}
    .header{color:#fff;text-align:center;margin-bottom:14px}
    .header h1{font-size:2rem;margin-bottom:6px;text-shadow:0 2px 12px rgba(0,0,0,.25)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{background:#fff;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.08);padding:16px}
    .card h2{font-size:1.05rem;margin-bottom:10px;border-bottom:3px solid #0ea5e9;display:inline-block;padding-bottom:4px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:600}
    .ok{background:#dcfce7;color:#14532d}
    .bad{background:#fee2e2;color:#7f1d1d}
    .mono{font-family:ui-monospace,Menlo,monospace;background:#f8fafc;border-radius:10px;padding:10px}
    .input,.select{padding:10px;border:1px solid #e2e8f0;border-radius:10px}
    .btn{background:linear-gradient(135deg,#0ea5e9 0%,#6366f1 100%);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .chart-box{position:relative;height:240px}
    .gauge{height:14px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .gauge > div{height:100%;background:linear-gradient(90deg,#22c55e,#ef4444);width:50%}
    ul{margin-left:18px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîé XRP Signal Board</h1>
      <div>Order Book Imbalance ‚Ä¢ VWAP ‚Ä¢ Volume Spike ‚Ä¢ Liquidity Sweep ‚Ä¢ Funding & OI</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Live & Order Book</h2>
        <div class="row" style="margin-bottom:8px">
          <div>Price: <b id="price">$0.0000</b> <small id="priceSource" style="color:#64748b">Source: ‚Äî</small></div>
          <div>OBI: <b id="obiVal">‚Äî</b> <small id="obiSide" class="pill">‚Äî</small></div>
        </div>
        <div class="gauge"><div id="obiGauge" style="width:50%"></div></div>
        <div class="row" style="margin-top:10px">
          <label>Depth levels <input id="depth" class="input" type="number" value="10" min="5" max="50" step="5" style="width:90px"/></label>
          <button class="btn" onclick="refreshOrderBook()">üîÑ Refresh OB</button>
        </div>
        <div class="row" style="gap:20px;margin-top:10px">
          <div>Bids (sum): <b id="sumBids">‚Äî</b></div>
          <div>Asks (sum): <b id="sumAsks">‚Äî</b></div>
        </div>
      </div>

      <div class="card">
        <h2>Futures Funding & OI</h2>
        <div class="row" style="gap:20px">
          <div>Funding Rate: <span id="funding" class="pill">‚Äî</span></div>
          <div>Open Interest: <b id="oi">‚Äî</b> XRP</div>
        </div>
        <div style="margin-top:10px;color:#64748b">*Snapshot dari Binance Futures; update tiap 60 detik.</div>
      </div>
    </div>

    <div class="grid" style="margin-top:14px">
      <div class="card">
        <h2>TF-5m ‚Äî Close & VWAP</h2>
        <div class="chart-box"><canvas id="chart5m"></canvas></div>
        <div class="row" style="gap:16px;margin-top:8px">
          <div>VWAP: <b id="vwap">‚Äî</b></div>
          <div>Dist to VWAP: <b id="distVWAP">‚Äî</b></div>
          <div>Volume Spike(1m vs 20m avg): <span id="volSpike" class="pill">‚Äî</span></div>
        </div>
      </div>

      <div class="card">
        <h2>Signals</h2>
        <div class="row" style="gap:10px;margin-bottom:8px">
          <button class="btn" onclick="scanSignals()">üîç Scan Now</button>
          <select id="sens" class="select">
            <option value="normal" selected>Sensitivity: Normal</option>
            <option value="high">High (lebih agresif)</option>
            <option value="low">Low (lebih konservatif)</option>
          </select>
        </div>
        <div id="signals" class="mono" style="max-height:300px;overflow:auto">[]</div>
        <div style="margin-top:8px;color:#64748b">Sinyal bersifat informatif ‚Äî tidak otomatis entry.</div>
      </div>
    </div>
  </div>

<script>
let lastPrice=3.0, priceSource='‚Äî';
let kl1=[], kl5=[], chart5=null;
let signalFeed=[];

function addSignal(type, side, strength, details){
  signalFeed.push({ts:new Date().toISOString(), type, side, strength, details});
  const el=document.getElementById('signals');
  el.textContent = JSON.stringify(signalFeed.slice(-60), null, 2);
}

// -------- Live Price ----------
async function fetchLivePrice(){
  try{
    const r = await fetch("https://api.binance.com/api/v3/ticker/price?symbol=XRPUSDT",{cache:"no-store"});
    if(!r.ok) throw new Error("binance");
    const j = await r.json();
    return { price: parseFloat(j.price), source:"Binance" };
  }catch(e){
    try{
      const r2 = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd",{cache:"no-store"});
      if(!r2.ok) throw new Error("cg");
      const j2=await r2.json();
      return { price: parseFloat(j2?.ripple?.usd), source:"CoinGecko" };
    }catch(e2){
      return { price: lastPrice||3.0, source:"Fallback" };
    }
  }
}
async function updatePrice(){
  const res = await fetchLivePrice();
  lastPrice = res.price; priceSource=res.source;
  document.getElementById('price').textContent = '$'+(Math.round(lastPrice*10000)/10000).toLocaleString();
  document.getElementById('priceSource').textContent = 'Source: '+priceSource;
}

// -------- Klines ----------
async function fetchKlines(symbol, interval, limit){
  const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
  const r = await fetch(url,{cache:'no-store'}); const j = await r.json();
  return j.map(x=>({t:x[0],o:+x[1],h:+x[2],l:+x[3],c:+x[4],v:+x[5]}));
}
function sma(arr, n, accessor){ const out=[]; let sum=0;
  for(let i=0;i<arr.length;i++){ const v=accessor(arr[i]); sum+=v; if(i>=n) sum-=accessor(arr[i-n]); out.push(i>=n-1?sum/n:null);} return out; }

function computeVWAP(kl){
  let pv=0, vol=0, vwapArr=[];
  for(const k of kl){
    const tp = (k.h+k.l+k.c)/3;
    pv += tp * k.v; vol += k.v;
    vwapArr.push(vol>0 ? pv/vol : null);
  }
  return vwapArr;
}

function draw5m(){
  const ctx=document.getElementById('chart5m').getContext('2d');
  const labels=kl5.map(k=>new Date(k.t).toLocaleTimeString());
  const close=kl5.map(k=>k.c);
  const vwap=computeVWAP(kl5);
  const vwapVal = vwap[vwap.length-1];
  document.getElementById('vwap').textContent = vwapVal ? vwapVal.toFixed(4) : '‚Äî';
  const dist = vwapVal ? ((lastPrice-vwapVal)/vwapVal*100) : 0;
  document.getElementById('distVWAP').textContent = vwapVal ? (dist>0?'+':'')+dist.toFixed(2)+'%' : '‚Äî';

  if(chart5) chart5.destroy();
  chart5 = new Chart(ctx, {
    type:'line',
    data:{ labels, datasets:[
      {label:'Close', data:close, fill:false, borderWidth:2},
      {label:'VWAP', data:vwap, fill:false, borderWidth:2}
    ]},
    options:{plugins:{legend:{position:'bottom'}},responsive:true,maintainAspectRatio:false}
  });
}

// -------- Volume Spike ----------
function volumeSpike(){
  if(kl1.length<25) return {spike:false, ratio:1};
  const last=kl1[kl1.length-1].v;
  const prev=kl1.slice(-21,-1).map(k=>k.v);
  const avg = prev.reduce((a,b)=>a+b,0)/prev.length;
  const ratio = avg>0 ? last/avg : 1;
  const spike = ratio>=1.5;
  document.getElementById('volSpike').textContent = spike ? `Spike ${ratio.toFixed(2)}x` : '‚Äî';
  document.getElementById('volSpike').className = 'pill ' + (spike?'ok':'');
  return {spike, ratio};
}

// -------- Liquidity Sweep (wick) ----------
function detectSweep(){
  if(kl5.length<20) return null;
  const window = kl5.slice(-18);
  const rangeHigh = Math.max(...window.map(k=>k.h));
  const rangeLow  = Math.min(...window.map(k=>k.l));
  const last = kl5[kl5.length-1];
  const upBreak = last.h > rangeHigh*1.0015 && last.c < rangeHigh;
  const downBreak= last.l < rangeLow*0.9985 && last.c > rangeLow;
  if(upBreak) return {side:'DOWN', details:`Up-sweep at ${last.h.toFixed(4)} ‚Üí close back ${last.c.toFixed(4)}`};
  if(downBreak) return {side:'UP', details:`Down-sweep at ${last.l.toFixed(4)} ‚Üí close back ${last.c.toFixed(4)}`};
  return null;
}

// -------- Order Book Imbalance ----------
async function refreshOrderBook(){
  const depth = Math.max(5, Math.min(50, parseInt(document.getElementById('depth').value)||10));
  const url = `https://api.binance.com/api/v3/depth?symbol=XRPUSDT&limit=${depth}`;
  try{
    const r = await fetch(url,{cache:'no-store'}); const j = await r.json();
    const sum = (arr)=> arr.reduce((a,[p,q])=> a + parseFloat(q), 0);
    const bids = sum(j.bids||[]), asks = sum(j.asks||[]);
    const total = bids+asks;
    const obi = total>0 ? (bids/total*100) : 50;
    document.getElementById('sumBids').textContent = bids.toFixed(0);
    document.getElementById('sumAsks').textContent = asks.toFixed(0);
    document.getElementById('obiVal').textContent = obi.toFixed(1) + '% bids';
    const side = obi>55 ? 'BUY-Bias' : obi<45 ? 'SELL-Bias' : 'Balanced';
    const pill = document.getElementById('obiSide');
    pill.textContent = side;
    pill.className = 'pill ' + (side==='BUY-Bias'?'ok':side==='SELL-Bias'?'bad':'');
    document.getElementById('obiGauge').style.width = Math.max(5, Math.min(95, Math.round(obi))) + '%';
    return {obi, side, bids, asks};
  }catch(e){
    document.getElementById('obiVal').textContent = '‚Äî';
    return {obi:50, side:'‚Äî', bids:0, asks:0};
  }
}

// -------- Funding & OI ----------
async function refreshFundingOI(){
  try{
    const fr = await fetch('https://fapi.binance.com/fapi/v1/fundingRate?symbol=XRPUSDT&limit=1',{cache:'no-store'});
    const jf = await fr.json();
    const rate = jf && jf[0] ? parseFloat(jf[0].fundingRate) : null;
    document.getElementById('funding').textContent = rate!=null ? (rate*100).toFixed(4)+'%' : '‚Äî';
    document.getElementById('funding').className = 'pill ' + (rate>0?'ok':'bad');
  }catch(e){
    document.getElementById('funding').textContent = '‚Äî';
  }
  try{
    const oi = await fetch('https://fapi.binance.com/fapi/v1/openInterest?symbol=XRPUSDT',{cache:'no-store'});
    const jo = await oi.json();
    const oiVal = jo && jo.openInterest ? parseFloat(jo.openInterest) : null;
    document.getElementById('oi').textContent = oiVal!=null ? oiVal.toLocaleString(undefined,{maximumFractionDigits:0}) : '‚Äî';
  }catch(e){
    document.getElementById('oi').textContent = '‚Äî';
  }
}

// -------- Scanner ----------
async function scanSignals(){
  await updatePrice();
  kl1 = await fetchKlines('XRPUSDT','1m',120);
  kl5 = await fetchKlines('XRPUSDT','5m',120);
  draw5m();
  const obiRes = await refreshOrderBook();
  await refreshFundingOI();

  const sens = document.getElementById('sens').value;

  if(obiRes.obi>=65){
    addSignal('OrderBookImbalance','UP','strong',`OBI=${obiRes.obi.toFixed(1)}% bids`);
  }else if(obiRes.obi<=35){
    addSignal('OrderBookImbalance','DOWN','strong',`OBI=${(100-obiRes.obi).toFixed(1)}% asks`);
  }else if(sens==='high' && (obiRes.obi>=60 || obiRes.obi<=40)){
    addSignal('OrderBookImbalance','‚Äî','medium',`OBI bias ${obiRes.obi.toFixed(1)}%`);
  }

  const vs = volumeSpike();
  if(vs.spike){
    const dir = kl1[kl1.length-1].c > kl1[kl1.length-2].c ? 'UP' : 'DOWN';
    addSignal('VolumeSpike', dir, vs.ratio>2?'strong':'medium', `${vs.ratio.toFixed(2)}x avg`);
  }

  const vwap=computeVWAP(kl5); const v = vwap[vwap.length-1];
  if(v){
    const dist = (lastPrice-v)/v*100;
    const th = sens==='high' ? 0.15 : sens==='low' ? 0.35 : 0.25;
    if(Math.abs(dist)>=th){
      addSignal('VWAP-Distance', dist>0?'UP':'DOWN', Math.abs(dist)>=th*2?'strong':'medium', `${dist>0?'+':''}${dist.toFixed(2)}%`);
    }
  }

  const sw = detectSweep();
  if(sw){
    addSignal('LiquiditySweep', sw.side, 'strong', sw.details);
  }
}

// -------- Boot ----------
async function boot(){
  await updatePrice();
  kl1 = await fetchKlines('XRPUSDT','1m',120);
  kl5 = await fetchKlines('XRPUSDT','5m',120);
  draw5m();
  await refreshOrderBook();
  await refreshFundingOI();
  setInterval(updatePrice, 15000);
  setInterval(refreshOrderBook, 15000);
  setInterval(refreshFundingOI, 60000);
}
document.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
