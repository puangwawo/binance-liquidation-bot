
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XRP Liquidation Bot Dashboard â€“ GitHub Pages</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color:#333; }
    .container{ max-width:1400px; margin:0 auto; padding:20px; }
    .header{ text-align:center; margin-bottom:30px; color:white; }
    .header h1{ font-size:2.2rem; margin-bottom:8px; text-shadow:2px 2px 4px rgba(0,0,0,.3); }
    .header p{ opacity:.9; }
    .stats-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px; margin-bottom:30px; }
    .stat-card{ background:white; padding:22px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,.1); text-align:center; transition:transform .3s, box-shadow .3s; }
    .stat-card:hover{ transform:translateY(-4px); box-shadow:0 15px 40px rgba(0,0,0,.15); }
    .stat-value{ font-size:2.1rem; font-weight:700; color:#667eea; margin-bottom:8px; }
    .stat-label{ color:#666; text-transform:uppercase; letter-spacing:1px; font-size:.95rem; }
    .price-source { font-size:.8rem; color:#888; margin-top:6px; }
    .main-content{ display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:30px; }
    .card{ background:white; border-radius:15px; padding:22px; box-shadow:0 10px 30px rgba(0,0,0,.1); }
    .card h2{ color:#333; margin-bottom:16px; font-size:1.3rem; border-bottom:3px solid #667eea; padding-bottom:8px; }
    .signal-item{ background:#f8f9fa; border-radius:10px; padding:15px; margin-bottom:15px; border-left:4px solid #667eea; transition:all .3s; }
    .signal-item:hover{ background:#e9ecef; transform:translateX(5px); }
    .signal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .signal-action{ padding:5px 15px; border-radius:20px; font-weight:700; font-size:.9rem; }
    .signal-action.BUY{ background:#28a745; color:#fff; }
    .signal-action.SELL{ background:#dc3545; color:#fff; }
    .signal-action.HOLD{ background:#ffc107; color:#333; }
    .confidence-bar{ width:100%; height:8px; background:#e9ecef; border-radius:4px; overflow:hidden; margin:10px 0; }
    .confidence-fill{ height:100%; background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%); transition: width .3s; }
    .controls{ text-align:center; margin-bottom:30px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
    .btn{ background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; border:none; padding:12px 22px; border-radius:25px; font-size:1rem; cursor:pointer; transition:all .3s; }
    .btn:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.2); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .chart-container{ position:relative; height:300px; margin-top:10px; }
    @media (max-width: 768px){ .main-content{ grid-template-columns:1fr; } .header h1{ font-size:1.8rem; } .stats-grid{ grid-template-columns:1fr; } }
    .risk-indicator{ display:inline-block; padding:3px 8px; border-radius:12px; font-size:.8rem; font-weight:700; margin-left:10px; }
    .risk-LOW{ background:#d4edda; color:#155724; }
    .risk-MEDIUM{ background:#fff3cd; color:#856404; }
    .risk-HIGH{ background:#f8d7da; color:#721c24; }
    .blink{ animation:blink 1s steps(2,start) 4; } @keyframes blink{ to { visibility:hidden; } }
    .footer{ text-align:center; color:white; opacity:.85; margin:18px 0 6px; font-size:.9rem; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸš€ XRP Liquidation Bot Dashboard</h1>
      <p>Pure Frontend (GitHub Pages Ready) â€” Live Price + Local Signals</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="currentPrice">$0.00</div>
        <div class="stat-label">XRP Price (USDT)</div>
        <div class="price-source" id="priceSource">Source: â€”</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalLiquidations">0</div>
        <div class="stat-label">Total Liquidations</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalSignals">0</div>
        <div class="stat-label">Trading Signals</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avgConfidence">0%</div>
        <div class="stat-label">Avg Confidence</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalVolume">$0</div>
        <div class="stat-label">Total Volume</div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" onclick="refreshAll()">ðŸ”„ Refresh</button>
      <button class="btn" onclick="simulateNew()">âš¡ Generate New Signals</button>
      <button class="btn" onclick="clearData()">ðŸ§¹ Clear</button>
    </div>

    <div class="main-content">
      <div class="card">
        <h2>ðŸ“Š Signal Distribution</h2>
        <div class="chart-container">
          <canvas id="signalChart"></canvas>
        </div>
      </div>

      <div class="card">
        <h2>ðŸŽ¯ Latest Trading Signals</h2>
        <div id="signalsList">
          <p style="text-align: center; color: #666; margin: 50px 0;">No signals yet. Click "Generate New Signals".</p>
        </div>
      </div>
    </div>

    <div class="footer">
      Frontend only. Price from Binance (fallback CoinGecko). Signals simulated client-side & saved in your browser.
    </div>
  </div>

  <script>
    let signalChart = null;
    const LS_KEY = "xrp_signals_v1";

    function getSignals() {
      try {
        return JSON.parse(localStorage.getItem(LS_KEY)) || [];
      } catch (_) {
        return [];
      }
    }
    function setSignals(arr) {
      localStorage.setItem(LS_KEY, JSON.stringify(arr));
    }
    function clearData() {
      localStorage.removeItem(LS_KEY);
      updateSignals([]);
      updateChart([]);
      updateStats([]);
    }

    async function fetchLivePrice() {
      // Binance first
      try {
        const r = await fetch("https://api.binance.com/api/v3/ticker/price?symbol=XRPUSDT", { cache: "no-store" });
        if (!r.ok) throw new Error("Binance not OK");
        const j = await r.json();
        const p = parseFloat(j.price);
        if (isFinite(p) && p > 0) return { price: p, source: "Binance" };
        throw new Error("Invalid Binance response");
      } catch (e) {
        // CoinGecko fallback
        try {
          const r2 = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd", { cache: "no-store" });
          if (!r2.ok) throw new Error("CoinGecko not OK");
          const j2 = await r2.json();
          const p2 = parseFloat(j2?.ripple?.usd);
          if (isFinite(p2) && p2 > 0) return { price: p2, source: "CoinGecko" };
          throw new Error("Invalid CoinGecko response");
        } catch (e2) {
          return { price: 3.00, source: "Fallback 3.00" };
        }
      }
    }

    async function updatePriceCard() {
      const { price, source } = await fetchLivePrice();
      const el = document.getElementById('currentPrice');
      const src = document.getElementById('priceSource');
      el.textContent = '$' + (Math.round(price * 10000) / 10000).toLocaleString();
      src.textContent = 'Source: ' + source;
      el.classList.add('blink');
      setTimeout(() => el.classList.remove('blink'), 800);
      return price;
    }

    function updateStats(signals) {
      const total = signals.length;
      const totalVol = signals.reduce((acc, s) => acc + (parseFloat(s.liquidation_data.o.q) * parseFloat(s.liquidation_data.o.p)), 0);
      const avgConf = total ? (signals.reduce((a, s) => a + (s.confidence || 0), 0) / total) : 0;
      document.getElementById('totalLiquidations').textContent = total.toString();
      document.getElementById('totalSignals').textContent = total.toString();
      document.getElementById('avgConfidence').textContent = Math.round(avgConf) + '%';
      document.getElementById('totalVolume').textContent = '$' + Math.round(totalVol).toLocaleString();
    }

    function updateSignals(signals) {
      const signalsList = document.getElementById('signalsList');
      if (!signals || signals.length === 0) {
        signalsList.innerHTML = '<p style="text-align: center; color: #666; margin: 50px 0;">No signals yet. Click "Generate New Signals".</p>';
        return;
      }
      signalsList.innerHTML = signals.slice(-10).reverse().map(signal => `
        <div class="signal-item">
          <div class="signal-header">
            <span class="signal-action ${signal.recommendation}">${signal.recommendation}</span>
            <span class="risk-indicator risk-${signal.risk_level}">${signal.risk_level} RISK</span>
          </div>
          <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
            ${signal.liquidation_data.o.q} XRP @ $${signal.liquidation_data.o.p}
            (${signal.liquidation_data.o.S} liquidation)
          </div>
          <div class="confidence-bar">
            <div class="confidence-fill" style="width: ${(signal.confidence || 0) * 10}%"></div>
          </div>
          <div style="font-size: 0.8rem; color: #666;">
            Confidence: ${signal.confidence || 0}/10 | ${(signal.reasoning || '').substring(0, 100)}...
          </div>
        </div>
      `).join('');
    }

    function updateChart(signals) {
      const buyCount = signals.filter(s => s.recommendation === 'BUY').length;
      const sellCount = signals.filter(s => s.recommendation === 'SELL').length;
      const holdCount = signals.filter(s => s.recommendation === 'HOLD').length;
      const ctx = document.getElementById('signalChart').getContext('2d');
      if (signalChart) signalChart.destroy();
      signalChart = new Chart(ctx, {
        type: 'doughnut',
        data: { labels: ['BUY', 'SELL', 'HOLD'], datasets: [{ data: [buyCount, sellCount, holdCount], backgroundColor: ['#28a745', '#dc3545', '#ffc107'], borderWidth: 0 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
      });
    }

    function randomFrom(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

    async function simulateNew() {
      const live = await updatePriceCard();
      const sides = ["BUY", "SELL"];
      const quantities = [2000, 3500, 4000, 5500, 7000, 8500];
      const price = (live * (1 + (Math.random()*0.02 - 0.01))).toFixed(4); // Â±1%
      const liq = {
        e: "forceOrder",
        E: Date.now(),
        o: {
          s: "XRPUSDT",
          S: randomFrom(sides),
          q: String(randomFrom(quantities)),
          p: String(price),
          ap: String(price),
          X: "FILLED"
        }
      };
      const meets = parseFloat(liq.o.q) >= 3000;
      const processed = {
        ...liq,
        timestamp: new Date(liq.E).toISOString(),
        quantity_usd: parseFloat(liq.o.q) * parseFloat(liq.o.p),
        meets_criteria: meets
      };
      if (meets) {
        const signal = {
          liquidation_data: processed,
          recommendation: processed.o.S === "SELL" ? "BUY" : "SELL",
          confidence: 7,
          risk_level: "MEDIUM",
          reasoning: "Rule-of-thumb mapping from liquidation direction (demo)."
        };
        const arr = getSignals();
        arr.push(signal);
        setSignals(arr);
        updateSignals(arr);
        updateChart(arr);
        updateStats(arr);
      }
    }

    async function refreshAll() {
      await updatePriceCard();
      const arr = getSignals();
      updateSignals(arr);
      updateChart(arr);
      updateStats(arr);
    }

    document.addEventListener('DOMContentLoaded', () => {
      refreshAll();
      setInterval(updatePriceCard, 15000);
    });
  </script>
</body>
</html>
